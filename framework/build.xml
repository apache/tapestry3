<?xml version="1.0"?>
<!-- $Id$ -->
<project name="Tapestry Framework" default="install">
	<property name="root.dir" value=".."/>
	<property file="${root.dir}/config/Version.properties"/>
	<property file="${root.dir}/config/common.properties"/>
	<property file="${root.dir}/config/build.properties"/>
	
	<path id="jetty.classpath">
		<fileset dir="${jetty.dir}">
			<include name="**/javax.*.jar"/>
		</fileset>
	</path>
	<path id="project.class.path">
		<fileset dir="${root.lib.dir}">
			<include name="${ext.dir}/*.jar"/>
		</fileset>
		<path refid="jetty.classpath"/>
	</path>
	<target name="init">
		<mkdir dir="${classes.dir}"/>
	</target>
	<target name="clean">
		<delete dir="${classes.dir}"/>
	</target>
	<target name="compile" depends="init"
		description="Compile all classes in the framework.">
		<javac srcdir="${src.dir}" destdir="${classes.dir}" debug="on"
			target="1.1">
			<classpath refid="project.class.path"/>
		</javac>
	</target>
	<target name="install" depends="compile"
		description="Compile all classes and build the installed JAR including all package resources."
		>
		<copy file="${root.dir}/config/Version.properties"
			todir="${classes.dir}/org/apache/tapestry"/>
		<jar jarfile="${root.lib.dir}/${framework.jar}">
			<fileset dir="${classes.dir}">
                                <exclude name="**/wml/**"/>
			</fileset>

			<fileset dir="${src.dir}">
				<exclude name="**/*.java"/>
				<exclude name="**/package.html"/>
                                <exclude name="**/wml/**"/>
			</fileset>
			
			<!-- Yes, this is odd.  Until I figure out how to get the framework TLD visible
				 to Jetty while debugging, the best place for the TLD is in the
				 Workbench's WEB-INF.  Don't want to duplicate it, so we just
				 reach out and grab it, to include in the Tapestry framework.  -->
				 
			<metainf dir="../examples/Workbench/context/WEB-INF">
				<include name="*.tld"/>
			</metainf>
		</jar>

		<jar jarfile="${root.lib.dir}/${wml.jar}">
			<fileset dir="${classes.dir}">
				<include name="**/wml/**"/>
			</fileset>
			<fileset dir="${src.dir}">
				<exclude name="**/*.java"/>
				<exclude name="**/package.html"/>
				<include name="**/wml/**"/>
			</fileset>
		</jar>

	</target>
</project>

<?xml version="1.0"?>
<!-- $Id$ -->
<project name="Tapestry VlibBeans Example" default="install">


  <property name="root.dir" value="../.."/>
  <property file="${root.dir}/config/Version.properties"/>
  <property file="${root.dir}/config/build.properties"/>
  <property file="${root.dir}/config/common.properties"/>
  
  <path id="project.class.path">
    <pathelement location="${lib.ext.dir}/javax.servlet.jar"/>
    <pathelement location="${lib.ext.dir}/${log4j.jar}"/>
    <pathelement location="${lib.ext.dir}/javax.xml.jaxp.jar"/>
    <pathelement location="${lib.ext.dir}/org.apache.crimson.jar"/>
    <pathelement location="${framework.jar}"/>
    <pathelement location="${jboss.client.dir}/jboss-client.jar"/>
    <pathelement location="${jboss.client.dir}/jboss-j2ee.jar"/>
    <pathelement location="${jboss.lib.dir}/jboss-jmx.jar"/>    
    <pathelement location="${jboss.lib.dir}/jboss-system.jar"/>
    <pathelement location="${jboss.lib.dir}/jboss-common.jar"/>   
    <pathelement location="${jboss.server.all.lib.dir}/mail.jar"/> 
    <pathelement location="${lib.ext.dir}/${ognl.jar}"/>
  </path>
    
  <target name="init">
    <mkdir dir="${classes.dir}"/>
  </target>
  
  <target name="clean">
    <delete dir="${classes.dir}"/>
  </target>
  
  <target name="compile" depends="init" 
  	description="Compile all classes in the JAR.">
    <javac 
    	srcdir="${src.dir}" 
    	destdir="${classes.dir}" 
    	debug="on" target="1.1">
      <classpath refid="project.class.path"/>
    </javac>
  </target>
  
  <!-- No particular need to use the ejbjar task here, this project isolates all the
       VlibBeans related code into one place, so there's no need to "reconstruct" what's
       needed from the deployment descriptors. -->
  
  <target name="install" depends="compile" description="Compile all classes and build the installed JAR including all package resources.">
    <jar jarfile="${vlibbeans.jar}">
      <fileset dir="${classes.dir}"/>
      <metainf dir=".">
        <include name="*.xml"/>
        <exclude name="build.xml"/>
      </metainf>
    </jar>
  </target>

  <target name="run" description="Deploy the JAR file and run the Jboss server." depends="install">
    <copy file="${vlibbeans.jar}" todir="${jboss.dir}/deploy"/>
    <java dir="${jboss.dir}/bin" classname="org.jboss.Main" fork="true">
      <classpath>
         <pathelement location="${jboss.dir}/bin/run.jar"/>
         <pathelement location="${jboss.lib.dir}/crimson.jar"/>
      </classpath>
      <sysproperty key="javax.xml.parsers.DocumentBuilderFactory" value="org.apache.crimson.jaxp.DocumentBuilderFactoryImpl"/>
      <sysproperty key="javax.xml.parsers.SAXParserFactory" value="org.apache.crimson.jaxp.SAXParserFactoryImpl"/>
    </java>
  </target>
  
</project>


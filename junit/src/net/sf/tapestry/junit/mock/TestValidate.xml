<?xml version="1.0" encoding="UTF-8"?>

<!-- $Id$ -->


<!-- Tests IPage.validate(), PageRedirectException and PageCallback -->

<mock-test>
    <context name="mock"/>
    
    <servlet name="app" class="net.sf.tapestry.ApplicationServlet">
  		<init-parameter
  			name="net.sf.tapestry.application-specification"
  			value="/net/sf/tapestry/junit/mock/app/Mock.application"/>
  	</servlet> 
  	  	
	<request>
  		<parameter name="service" value="page"/>
  		<parameter name="context" value="Protected"/>
  		
  		
  		<assert-output name="Title">
<![CDATA[
<title>Guard</title>
]]>
		</assert-output>
		
		<assert-output name="Link URL">
<![CDATA[
href="/mock/app\?service=direct&amp;context=Guard/link"
]]>
		</assert-output>
		
		<assert-output name="Callback">
<![CDATA[
Callback: PageCallback\[Protected\]
]]>		
		</assert-output>		
  	</request>
  	
  	<!-- Simulate clicking the link, which should send the
  	     user to the Protected page.  -->
  	     
  	<request>
  		<parameter name="service" value="direct"/>
  		<parameter name="context" value="Guard/link"/>
  		
  		<assert-output name="Title">
<![CDATA[
<title>Protected</title>
]]>
		</assert-output>
		
	</request>
	

	<!-- Now, try the original request again, now that the Guard
		 page has had its say. -->

	<request>
  		<parameter name="service" value="page"/>
  		<parameter name="context" value="Protected"/>
  		
  		<assert-output name="Title">
<![CDATA[
<title>Protected</title>
]]>
		</assert-output>
				
	</request>
	  	
</mock-test>